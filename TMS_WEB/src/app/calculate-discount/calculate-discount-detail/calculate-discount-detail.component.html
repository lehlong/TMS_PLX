<div class="container-list">
  <div class="site-page-header-ghost-wrapper">
    <nz-page-header nzBackIcon [nzTitle]="titleTab" class="site-page-header">
      <nz-page-header-extra>
        <nz-space [nzWrap]="true" class="gap-[5px]">
          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('01', '02')"
            [appPermission]="IMPORT_BATCH.BROWSE_IMPORT_BATCH"
            *ngIf="input.header.status == '01' || input.header.status == '03'">
            <span nz-icon nzType="send"></span> Trình duyệt
          </button>

          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('05', '06')"
            [appPermission]="IMPORT_BATCH.CANCEL_BROWSE" *ngIf="input.header.status == '02'">
            <span nz-icon nzType="close"></span> Hủy trình duyệt
          </button>

          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('02', '03')"
            [appPermission]="IMPORT_BATCH.REQUEST_IMPORT_BATCH_EDIT" *ngIf="input.header.status == '02'">
            <span nz-icon nzType="undo"></span> Yêu cầu chỉnh sửa
          </button>

          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('03', '04')"
            [appPermission]="IMPORT_BATCH.APPROVE_IMPORT_BATCH" *ngIf="input.header.status == '02'">
            <span nz-icon nzType="check"></span> Phê duyệt
          </button>

          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('06', '07')"
            [appPermission]="IMPORT_BATCH.CANCEL_APPROVAL" *ngIf="input.header.status == '04'">
            <span nz-icon nzType="close"></span> Hủy phê duyệt
          </button>

          <button class="!flex !items-center" nzType="default" nz-button (click)="changeStatus('04', '05')"
            [appPermission]="IMPORT_BATCH.REJECT_IMPORT_BATCH" *ngIf="input.header.status == '02'">
            <span nz-icon nzType="close"></span> Từ chối
          </button>



          <button [appPermission]="IMPORT_BATCH.INPUT_DATA" nzType="default" nz-button (click)="openInput()">
            <span nz-icon nzType="right-square"></span> Dữ liệu đầu vào
          </button>

          <button [appPermission]="IMPORT_BATCH.RECALCULATE" nzType="default" nz-button (click)="reCalculate()">
            <span nz-icon nzType="calculator"></span> Tính toán lại
          </button>

          <button nz-button nz-dropdown [nzDropdownMenu]="export" *ngIf="hasExportPermission()">
            <span nz-icon nzType="file"></span>
            Xuất file
            <span nz-icon nzType="down"></span>
          </button>
          <nz-dropdown-menu #export="nzDropdownMenu">
            <ul nz-menu>
              <li [appPermission]="IMPORT_BATCH.EXPORT_TO_EXCEL" nz-menu-item (click)="exportExcel()">Xuất Excel</li>
              <li [appPermission]="IMPORT_BATCH.EXPORT_TO_WORD" nz-menu-item (click)="exportWord()">Xuất Thông Báo Giá
              </li>
              <li [appPermission]="IMPORT_BATCH.EXPORT_TO_EXCEL" nz-menu-item><button (click)="exportWordTrinhKy()">Xuất
                  Trình ký</button></li>
            </ul>
          </nz-dropdown-menu>

          <button nz-button nz-dropdown [nzDropdownMenu]="history" [appPermission]="IMPORT_BATCH.HISTORY">
            <span nz-icon nzType="history"></span>
            Lịch sử
            <span nz-icon nzType="down"></span>
          </button>
          <nz-dropdown-menu #history="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item (click)="showHistoryAction()">Lịch sử hành động</li>
              <li nz-menu-item (click)="showHistoryExport()">Lịch sử xuất file</li>
              <li nz-menu-item (click)="showEmailAction()">Lịch sử gửi Mail</li>
              <li nz-menu-item (click)="showSMSAction()">Lịch sử gửi SMS</li>

              <!-- <li nz-menu-item (click)="showEmailAction()"
                *ngIf="input.header.status == '04' || input.header.status == '08'">Lịch sử gửi Mail</li>
              <li nz-menu-item (click)="showSMSAction()"
                *ngIf="input.header.status == '04' || input.header.status == '08'">Lịch sử gửi SMS</li> -->
            </ul>
          </nz-dropdown-menu>

          <button [appPermission]="IMPORT_BATCH.SEND_EMAIL" (click)="showEmailAction()" nzType="primary" nz-button>
            <span nz-icon nzType="mail"></span> Gửi Email
          </button>
          <div class="">
            <button [appPermission]="IMPORT_BATCH.SEND_SMS" class="btn-email" [nzDropdownMenu]="menu" nz-dropdown
              [nzPlacement]="'bottomRight'" nz-button (click)="showSMSAction()">
              <span nz-icon style="color:white" nzType="message"></span>Gửi SMS
            </button>
            <nz-dropdown-menu #menu="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item style="border-bottom: 1px solid #d9d9d9;"
                  (click)="confirmSendSMS('SMS Thông báo giá bán lẻ niêm yết')">Tạo tin nhắn TB Giá bán lẻ</li>
                <li nz-menu-item (click)="confirmSendSMS('SMS thông báo thù lao')">Tạo tin nhắn TB thù lao</li>
              </ul>
            </nz-dropdown-menu>
          </div>
          <ng-container *ngIf="currentTab !== '' && currentTab !== 'DLG'">
            <app-input-clear placeholder="Tìm kiếm" (enterEvent)="search(currentTab)"
              [(value)]="searchInput"></app-input-clear>
            <button (click)="search(currentTab)" class="flex !items-center !border-l-0 gray-btn" nzType="default"
              nz-button nzType="default">
              <span nz-icon nzType="search"></span>
            </button>
          </ng-container>
          <button nz-button nzType="default" (click)="fullScreen()">
            <span nz-icon nzType="fullscreen"></span>
          </button>
        </nz-space>
      </nz-page-header-extra>
    </nz-page-header>
  </div>


  <div [ngClass]="isZoom ? 'zoom' : ''">
    <button nz-button [ngClass]="isZoom ? 'd-block close' : 'd-none'" nzType="default" (click)="closeFullScreen()">
      <span nz-icon nzType="fullscreen-exit"></span>
    </button>
    <nz-tabset>
      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_DLG)" nzTitle="Dữ liệu gốc"
        (nzClick)="reset('DLG')">
        <!-- <div class="overflow-tab"> -->
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <div nz-row [nzGutter]="12">
            <div nz-col class="gutter-row" [nzSpan]="6">
              <div class="inner-box">
                <nz-divider nzOrientation="left" nzText="GIÁ TẬP ĐOÀN CÔNG BỐ"></nz-divider>
                <nz-table nzBordered nzSize="small" [nzFrontPagination]="'false'" [nzShowPagination]="'false'"
                  [nzData]="output.dlg.dlg1">
                  <thead>
                    <tr>
                      <th rowspan="2">MẶT HÀNG</th>
                      <th rowspan="2">GBL V1</th>
                      <th rowspan="2">GBL V2</th>
                      <th rowspan="2">CL 2V <br> TĐ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of output.dlg.dlg1;">
                      <td nzAlign="left">{{data.goodName}}</td>
                      <td nzAlign="right">{{ data.col1 | number}}</td>
                      <td nzAlign="right">{{ data.col2 | number }}</td>
                      <td nzAlign="right" *ngIf="data.col3 < 0">(-) {{ data.col3 * -1 }}</td>
                      <td nzAlign="right" *ngIf="data.col3 > 0">
                        <ng-container *ngIf="data.col3 > 0">
                          (+) {{ data.col3 }}
                        </ng-container>
                      </td>
                      <td nzAlign="right" *ngIf="data.col3 == 0">{{ data.col3 }}</td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="9">
              <div class="inner-box">
                <nz-divider nzOrientation="left" nzText="THÔNG BÁO GIÁ BÁN LẺ"></nz-divider>
                <nz-table nzBordered nzSize="small" [nzFrontPagination]="'false'" [nzShowPagination]="'false'"
                  [nzData]="output.dlg.dlg2">
                  <thead>
                    <tr>
                      <th rowspan="2">MẶT HÀNG</th>
                      <th rowspan="2">GIÁ BÁN LẺ V1+ <br> Vùng thị trường <br> trung
                        tâm (TP Vinh)</th>
                      <th rowspan="2">GIÁ BÁN LẺ V2 <br> Vùng thị trường còn lại <br>
                        (bằng giá V2 TĐ công bố)</th>
                      <th rowspan="2">CL 2V <br>CTY</th>
                    </tr>

                  </thead>
                  <tbody>
                    <tr *ngFor="let data of output.dlg.dlg2;">
                      <td nzAlign="left">{{data.goodName}}</td>
                      <td nzAlign="right">{{ data.col1 | number}}</td>
                      <td nzAlign="right">{{ data.col2 | number }}</td>
                      <td nzAlign="right">
                        <ng-container *ngIf="data.col3 > 0">
                          (+) {{ data.col3 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 < 0">
                          (-) {{ data.col3 * -1 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4" style="padding: 12px 24px;">
                        <span>Ghi chú:</span> <br>
                        <span>- Các CHXD vùng thị trường trung tâm bao gồm: <br>
                          CH01, CH02, CH03, CH04, CH05, CH06, CH07, CH08, CH09, <br>
                          CH10, CH11, CH12, CH15, CH16, CH17, CH20, CH21 và CH22.</span><br>
                        <span>- Các CHXD còn lại: bán theo giá vùng 2 <br>
                          Tập đoàn công bố cùng thời điểm.</span>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="9">
              <div class="inner-box">
                <nz-divider nzOrientation="left" nzText="THÔNG BÁO GIÁ BÁN LẺ"></nz-divider>
                <nz-table nzBordered nzSize="small" [nzFrontPagination]="'false'" [nzShowPagination]="'false'"
                  [nzData]="output.dlg.dlg3">
                  <thead>
                    <tr>
                      <th rowspan="2">MẶT HÀNG</th>
                      <th rowspan="2">GIÁ KỲ TRƯỚC</th>
                      <th rowspan="2">GIÁ KỲ NÀY</th>
                      <th rowspan="2">TĂNG(+), GIẢM(-)</th>
                    </tr>

                  </thead>
                  <tbody>
                    <tr *ngFor="let data of output.dlg.dlg3;">
                      <td nzAlign="left" *ngIf="data.isBold" colspan="4" style="font-weight: bold;">
                        {{data.goodName}}</td>
                      <td nzAlign="left" *ngIf="!data.isBold">{{data.goodName}}</td>
                      <td nzAlign="right" *ngIf="!data.isBold">{{ data.col1 | number}}</td>
                      <td nzAlign="right" *ngIf="!data.isBold">{{ data.col2 | number }}</td>
                      <td nzAlign="right" *ngIf="!data.isBold">
                        <ng-container *ngIf="data.col3 > 0">
                          (+) {{ data.col3 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 < 0">
                          (-) {{ data.col3 * -1 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
          </div>

          <div nz-row [nzGutter]="12">
            <div nz-col class="gutter-row" [nzSpan]="17">
              <div class="inner-box">
                <nz-divider nzText="BIỂU TỔNG HỢP CÁC CHỈ TIÊU DẦU SÁNG (PT bán lẻ - V2)"
                  nzOrientation="left"></nz-divider>
                <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
                  [nzData]="output.dlg.dlg4">
                  <thead>
                    <tr>
                      <th rowSpan="2">STT</th>
                      <th rowSpan="2">LOẠI HÀNG</th>
                      <th rowSpan="2">
                        H.SỐ VCF <br />
                        BQ MÙA <br />
                        MIỀN
                      </th>
                      <th rowSpan="2">
                        THUẾ <br />
                        BVMT
                      </th>
                      <th colSpan="3">
                        GIÁ BÁN NỘI BỘ TẬP ĐOÀN
                      </th>
                      <th rowSpan="2">
                        GIÁ BÁN LẺ <br />
                        CƠ SỞ (VÙNG 1) <br />
                        CÓ VAT &BVMT
                      </th>
                      <th colSpan="2">GIÁ BÁN LẺ VÙNG 2</th>
                      <th colSpan="2">LÃI GỘP (Đ/LTT)</th>
                    </tr>
                    <tr>
                      <th>L15 <br> CHƯA VAT <br />& BVMT</th>
                      <th>LTT<br> CHƯA VAT <br />& BVMT</th>
                      <th>LTT <br> CÓ VAT <br /> & BVMT</th>
                      <th>GIÁ <br> CÔNG BỐ</th>
                      <th>CHƯA VAT <br> & BVMT</th>
                      <th>CÓ VAT <br> & BVMT</th>
                      <th>CHƯA VAT <br> & BVMT</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of output.dlg.dlg4;">
                      <td nzAlign="center">{{data.stt}}</td>
                      <td nzAlign="left">{{ data.goodName}}</td>
                      <td nzAlign="right">{{ data.col1 }}</td>
                      <td nzAlign="right">{{ data.col2 | number}}</td>
                      <td nzAlign="right">{{ data.col3 | number}}</td>
                      <td nzAlign="right">{{ data.col4 | number}}</td>
                      <td nzAlign="right">{{ data.col5 | number}}</td>
                      <td nzAlign="right">{{ data.col6 | number}}</td>
                      <td nzAlign="right">{{ data.col7 | number}}</td>
                      <td nzAlign="right">{{ data.col8 | number}}</td>
                      <td nzAlign="right">{{ data.col9 | number}}</td>
                      <td nzAlign="right">{{ data.col10 | number}}</td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="7">
              <div class="inner-box">
                <nz-divider nzText="THAY ĐỔI GIÁ GIAO PT BÁN LẺ" nzOrientation="left"></nz-divider>

                <nz-table nzBordered nzSize="small" [nzFrontPagination]="'false'" [nzShowPagination]="'false'"
                  [nzData]="output.dlg.dlg5">
                  <thead>
                    <tr>
                      <th rowspan="2">MẶT HÀNG</th>
                      <th rowspan="2">GIÁ CŨ</th>
                      <th rowspan="2">GIÁ MỚI</th>
                      <th rowspan="2">TĂNG(+), GIẢM(-)</th>
                    </tr>

                  </thead>
                  <tbody>
                    <tr *ngFor="let data of output.dlg.dlg5;">
                      <td nzAlign="left">{{data.goodName}}</td>
                      <td nzAlign="right">{{ data.col1 | number}}</td>
                      <td nzAlign="right">{{ data.col2 | number }}</td>
                      <td nzAlign="right">
                        <ng-container *ngIf="data.col3 > 0">
                          (+) {{ data.col3 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 < 0">
                          (-) {{ data.col3 * -1 }}
                        </ng-container>
                        <ng-container *ngIf="data.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>

            <nz-divider nzText="BIỂU TỔNG HỢP CÁC CHỈ TIÊU DẦU SÁNG (ngoài bán lẻ)" nzOrientation="left"></nz-divider>
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.dlg.dlg6">
              <thead>
                <tr>
                  <th rowSpan="2" class="align-center">STT</th>
                  <th rowSpan="2" class="align-center">LOẠI HÀNG</th>
                  <th rowSpan="2" class="align-center">
                    H.SỐ VCF <br />
                    BQ MÙA <br />
                    MIỀN
                  </th>
                  <th rowSpan="2" class="align-center">
                    THUẾ <br />
                    BVMT
                  </th>
                  <th colSpan="3" class="align-center">
                    GIÁ BÁN NỘI BỘ TẬP ĐOÀN
                  </th>
                  <th colSpan="2" class="align-center">
                    GIÁ BÁN LẺ <br />
                    (Lít tt)
                  </th>
                  <th colSpan="2" class="align-center">
                    LÃI GỘP THEO <br />
                    GIÁ TĐ GIAO (Lít tt)
                  </th>
                  <th colSpan="2" class="align-center">LÃI GỘP ĐIỀU TIẾT</th>
                  <th colSpan="2" class="align-center">
                    LÃI GỘP LINH HOẠT <br />
                    (Đ/Lít tt)
                  </th>
                  <th rowSpan="2" class="align-center">
                    GIẢM GIÁ <br />
                    FOB CÓ VAT <br />
                    & BVMT
                  </th>
                  <th rowSpan="2" class="align-center">
                    LỢI NHUẬN <br />
                    CÓ THUẾ L15
                  </th>
                  <th rowSpan="2" class="align-center">
                    LỢI NHUẬN <br />
                    CÓ THUẾ Ltt
                  </th>
                </tr>
                <tr>
                  <th class="align-center">
                    L15 CHƯA VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    LTT CHƯA VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    LTT CÓ VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">GIÁ NIÊM YẾT</th>
                  <th class="align-center">
                    CHƯA VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    CÓ VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    CHƯA VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    L15 CHƯA VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    LTT CÓ VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    CÓ VAT <br />
                    & BVMT
                  </th>
                  <th class="align-center">
                    CHƯA VAT <br />
                    & BVMT
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of output.dlg.dlg6;">
                  <td nzAlign="center" *ngIf="data.isBold" style="font-weight: bold;">{{data.stt}}
                  </td>
                  <td nzAlign="left" *ngIf="data.isBold" style="font-weight: bold;" colspan="17">
                    {{data.goodName}}</td>

                  <td nzAlign="center" *ngIf="!data.isBold">{{data.stt}}</td>
                  <td nzAlign="left" *ngIf="!data.isBold">{{data.goodName}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col1}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col2 | number }}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col3 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col4 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col5 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col6 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col7 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col8 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col9 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col10 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col11 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col12 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col13 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col14 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col15 | number}}</td>
                  <td nzAlign="right" *ngIf="!data.isBold">{{ data.col16 | number}}</td>
                </tr>
              </tbody>
            </nz-table>


            <nz-divider nzText="BIỂU TÍNH GIÁ XUẤT NỘI DỤNG" nzOrientation="left"></nz-divider>
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.dlg.dlg7">
              <thead>
                <tr>
                  <th rowSpan="2" class="align-center">STT</th>
                  <th rowSpan="2" class="align-center">LOẠI HÀNG</th>
                  <th rowSpan="2" class="align-center">
                    H.SỐ VCF <br />
                    BQ MÙA <br />
                    MIỀN
                  </th>
                  <th rowSpan="2" class="align-center">
                    THUẾ <br />
                    BVMT
                  </th>
                  <th colSpan="2" class="align-center">GIÁ BÁN NỘI BỘ TĐ</th>
                  <th rowSpan="2" class="align-center">
                    GIÁ XUẤT <br> NỘI DỤNG <br />
                    (Bao gồm <br> VAT&BVMT)
                  </th>
                </tr>
                <tr>
                  <th class="align-center">
                    L15 CHƯA THUẾ <br />
                    VAT & BVMT
                  </th>
                  <th class="align-center">
                    LTT CHƯA THUẾ <br />
                    VAT & BVMT
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of output.dlg.dlg7;">
                  <td nzAlign="center">{{data.stt}}</td>
                  <td nzAlign="left">{{data.goodName}}</td>
                  <td nzAlign="right">{{ data.col1}}</td>
                  <td nzAlign="right">{{ data.col2 | number }}</td>
                  <td nzAlign="right">{{ data.col3 | number}}</td>
                  <td nzAlign="right">{{ data.col4 | number}}</td>
                  <td nzAlign="right">{{ data.col5 | number}}</td>
                </tr>
              </tbody>
            </nz-table>

            <nz-divider nzText="BIỂU TÍNH GIÁ BÁN CHO CÔNG TY CP VẬN TẢI VÀ DỊCH VỤ PETROLIMEX NGHỆ TĨNH"
              nzOrientation="left"></nz-divider>
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.dlg.dlg8">
              <thead>
                <tr>
                  <th rowSpan="2" class="align-center">STT</th>
                  <th rowSpan="2" class="align-center">LOẠI HÀNG</th>
                  <th rowSpan="2" class="align-center">
                    H.SỐ VCF <br />
                    BQ MÙA <br />
                    MIỀN
                  </th>
                  <th colSpan="2" class="align-center">THUẾ BVMT</th>
                  <th rowSpan="2" class="align-center">
                    GIÁ BÁN NỘI BỘ <br />
                    TĐ L15 CHƯA THUẾ <br />
                    VAT & BVMT
                  </th>
                  <th rowSpan="2" class="align-center">
                    CHI PHÍ QUA KHO <br />
                    THEO QUY ĐỊNH <br />
                    CỦA TĐ
                  </th>
                  <th colSpan="2" class="align-center">GIÁ BÁN CHO PTS</th>
                  <th rowSpan="2" class="align-center">GHI CHÚ</th>
                </tr>
                <tr>
                  <th class="align-center">THEO LTT</th>
                  <th class="align-center">THEO L15</th>
                  <th class="align-center">
                    L15 CHƯA THUẾ <br />
                    VAT, CÓ BVMT
                  </th>
                  <th class="align-center">
                    L15 CÓ THUẾ <br />
                    VAT & BVMT
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of output.dlg.dlg8;">
                  <td nzAlign="center">{{data.stt}}</td>
                  <td nzAlign="left">{{data.goodName}}</td>
                  <td nzAlign="right">{{ data.col1}}</td>
                  <td nzAlign="right">{{ data.col2 | number }}</td>
                  <td nzAlign="right">{{ data.col3 | number}}</td>
                  <td nzAlign="right">{{ data.col4 | number}}</td>
                  <td nzAlign="right">{{ data.col5 | number}}</td>
                  <td nzAlign="right">{{ data.col6 | number}}</td>
                  <td nzAlign="right">{{ data.col7 | number}}</td>
                  <td nzAlign="left">{{ data.note}}</td>
                </tr>
              </tbody>
            </nz-table>
          </div>
          <nz-divider
            [nzText]="'SO SÁNH VỚI KỲ - ' + (output.dlg?.nameOld ? output.dlg.nameOld : 'Không có đợt nào trước đó để so sánh')"
            nzOrientation="left"></nz-divider>

          <div nz-row [nzGutter]="16">
            <div nz-col class="gutter-row" [nzSpan]="12">
              <div class="inner-box">
                <nz-divider nzText="LÃI GỘP" nzOrientation="left"></nz-divider>
                <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered #dlgTable_7
                  [nzData]="output.dlg.dlg9">
                  <thead>
                    <tr>
                      <th class="align-center" rowspan="2">Mặt hàng</th>
                      <th class="align-center" colspan="3">
                        So sánh lãi gộp giữa hai kỳ
                      </th>
                    </tr>
                    <tr>
                      <th class="align-center">LG cũ</th>
                      <th class="align-center">LG mới</th>
                      <th class="align-center">Tăng/Giảm</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="bold-text" style="font-weight:bold" colspan="4">Vùng thị trường trung tâm</td>
                    </tr>
                    @for (d of dlgTable_7.data; track d) {
                    <tr *ngIf="d.localCode == 'V1'">
                      <td>{{ d.goodName }}</td>
                      <td class="align-right">
                        {{ d.col1 | number: '1.0-0' }}
                      </td>
                      <td class="align-right">
                        {{ d.col2 | number: '1.0-0' }}
                      </td>
                      <td class="align-right">
                        <ng-container *ngIf="d.col3 > 0">
                          (+) {{ d.col3| number: '1.0-0' }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 < 0">
                          (-) {{ (d.col3 * -1) | number: '1.0-0' }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                    }
                    <tr>
                      <td class="bold-text" style="font-weight:bold" colspan="4">Các vùng thị trường còn lại</td>
                    </tr>
                    @for (d of dlgTable_7.data; track d) {
                    <tr *ngIf="d.localCode === 'V2'">
                      <td>{{ d.goodName }}</td>
                      <td class="align-right">
                        {{ d.col1 | number: '1.0-0' }}
                      </td>
                      <td class="align-right">
                        {{ d.col2 | number: '1.0-0' }}
                      </td>
                      <td class="align-right">
                        <ng-container *ngIf="d.col3 > 0">
                          (+) {{ d.col3| number: '1.0-0' }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 < 0">
                          (-) {{ (d.col3 * -1)| number: '1.0-0' }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                    }
                  </tbody>
                </nz-table>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="12">
              <div class="inner-box">
                <nz-divider nzText="ĐỀ XUẤT MỨC GIẢM GIÁ" nzOrientation="left"></nz-divider>
                <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered #dlgTable_8
                  [nzData]="output.dlg.dlg10">
                  <thead>
                    <tr>
                      <th class="align-center" rowspan="2">Mặt hàng</th>
                      <th class="align-center" colspan="3">
                        So sánh chiết khấu giữa hai kỳ
                      </th>
                    </tr>
                    <tr>
                      <th class="align-center">CK cũ</th>
                      <th class="align-center">CK mới</th>
                      <th class="align-center">Tăng/Giảm</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (d of dlgTable_8.data; track d) {
                    <tr *ngIf="d.localCode == 'V2'">
                      <td>{{ d.goodName }}</td>
                      <td class="align-right">{{ d.col1 | number }}</td>
                      <td class="align-right">{{ d.col2 | number }}</td>
                      <td class="align-right">
                        <ng-container *ngIf="d.col3 > 0">
                          (+) {{ d.col3 }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 < 0">
                          (-) {{ d.col3 * -1 }}
                        </ng-container>
                        <ng-container *ngIf="d.col3 === 0">
                          0
                        </ng-container>
                      </td>
                    </tr>
                    }
                  </tbody>
                </nz-table>
              </div>
            </div>
          </div>
          <!-- </div> -->
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PT)" nzTitle="PT" (nzClick)="reset('PT')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pt">
            <thead>
              <tr>
                <th rowspan="3" *ngIf="accountGroups">TT</th>
                <th rowspan="3" *ngIf="accountGroups">THỊ TRƯỜNG</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">CỰ LY <br> BQ (Km)</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lãi gộp chưa VAT</th>
                <th colspan="3" *ngIf="accountGroups != 'G_NV_K'">Chi phí phát sinh chưa có VAT</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">CK điều tiết <br> (-/+)</th>
                <th colspan="8" *ngIf="accountGroups != 'G_NV_K'">Đề xuất mức giảm giá tại kho khách hàng</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lợi nhuận chưa VAT</th>
                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th colspan="2">Ron 95 III</th>
                  <th colspan="2">E5 - Ron 92 II</th>
                  <th colspan="2">DO 0.001S</th>
                  <th colspan="2">DO 0.05S</th>
                </ng-container>
              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th rowspan="2">Ron 95 III</th>
                <th rowspan="2">E5 - Ron 92 II</th>
                <th rowspan="2">DO 0.001S</th>
                <th rowspan="2">DO 0.05S</th>
                <th rowspan="2">Tổng <br> chi phí</th>
                <th rowspan="2">CP chung <br> chưa<br> cước vc</th>
                <th rowspan="2">Cước VC <br> bình quân</th>
                <th>Xăng</th>
                <th>Dầu</th>
                <th colspan="2">Ron 95 III</th>
                <th colspan="2">E5 - Ron 92 II</th>
                <th colspan="2">DO 0.001S</th>
                <th colspan="2">DO 0.05S</th>

                <th rowspan="2">Ron 95 III</th>
                <th rowspan="2">E5 - Ron 92 II</th>
                <th rowspan="2">DO 0.001S</th>
                <th rowspan="2">DO 0.05S</th>

                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                </ng-container>

              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th>Có VAT</th>
                <th>Có VAT</th>

                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
              </tr>

            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pt">
                <tr>
                  <td *ngIf="data.isBold"></td>
                  <td *ngIf="data.isBold" nzAlign="left" colspan="31" style="font-weight: bold;">
                    {{data.marketName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('PT') || data?.marketName?.toLowerCase().includes(getSearchTerm('PT').toLowerCase())">
                    <td *ngIf="!data.isBold " nzAlign="center">{{ data.stt}}</td>
                    <td *ngIf="!data.isBold " nzAlign="left" title="{{data.marketName}}"><span></span>{{ data.marketName
                      }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col4 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col5 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col6 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col7 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col8 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col9 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col10 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col11 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col12 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col13 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col14 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col15 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col16 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col17 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col18 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col19 < 0 ? 'red' : 'inherit'">{{_global.formatNegativeNumber(data.col19)}}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col20 < 0 ? 'red' : 'inherit'">{{_global.formatNegativeNumber(data.col20)}}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col21 < 0 ? 'red' : 'inherit'">{{_global.formatNegativeNumber(data.col21)}}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col22 < 0 ? 'red' : 'inherit'">{{_global.formatNegativeNumber(data.col22)}}
                    </td>
                    <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col23 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col24 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col25 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col26 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col27 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col28 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col29 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col30 | number}}</td>
                    </ng-container>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_DB)" nzTitle="ĐB" (nzClick)="reset('DB')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pt">
            <thead>
              <tr>
                <th rowspan="3">TT</th>
                <th rowspan="3">KHÁCH HÀNG</th>
                <th rowspan="3">THỊ TRƯỜNG</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">CỰ LY <br> BQ (Km)</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lãi gộp chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Chi phí phát sinh chưa có VAT</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">Hỗ trợ <br> cước v/c</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">Nguồn lực <br> Hỗ trợ</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">CK điều tiết <br> (-/+)</th>
                <th colspan="8" *ngIf="accountGroups != 'G_NV_K'">Đề xuất mức giảm giá tại kho khách hàng</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">CK Vòng 2 <br> đạt được <br> chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lợi nhuận chưa VAT</th>
                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th colspan="2">Ron 95 III</th>
                  <th colspan="2">E5 - Ron 92 II</th>
                  <th colspan="2">DO 0.001S</th>
                  <th colspan="2">DO 0.05S</th>
                </ng-container>
              </tr>
              <tr>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Tổng <br> chi phí</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">CP chung <br> chưa<br> cước vc</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Cước VC <br> bình quân</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Lãi vay <br> NH (đ/l)</th>
                <th *ngIf="accountGroups != 'G_NV_K'">Xăng</th>
                <th *ngIf="accountGroups != 'G_NV_K'">Dầu</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>

                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>

                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                </ng-container>

              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th>Có VAT</th>
                <th>Có VAT</th>

                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
              </tr>

            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.db;">
                <tr>
                  <td *ngIf="data.isBold"></td>
                  <td *ngIf="data.isBold" nzAlign="left" colspan="36" style="font-weight: bold;">{{data.customerName}}
                  </td>
                  <ng-container
                    *ngIf="!getSearchTerm('DB') || data?.customerName?.toLowerCase().includes(getSearchTerm('DB').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{ data.customerName }}</td>
                    <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col4 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col5 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col6 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col7 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col8 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col9 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col10 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col11 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col12 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col13 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col14 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col15 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col16 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col17 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col18 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col19 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col20 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col21 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col22 | number}}</td>

                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col23 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col23) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col24 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col24) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col25 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col25) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col26 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col26) }}
                    </td>
                    <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col27 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col28 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col29 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col30 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col31 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col32 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col33 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col34 | number}}</td>
                    </ng-container>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_FOB)" nzTitle="FOB"
        (nzClick)="reset('FOB')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.fob">
            <thead>
              <tr>
                <th rowspan="3">TT</th>
                <th rowspan="3">THỊ TRƯỜNG</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lãi gộp chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Chi phí phát sinh chưa có VAT</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">Nguồn lực <br> Hỗ trợ</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">CK điều tiết <br> (-/+)</th>
                <th colspan="8" *ngIf="accountGroups != 'G_NV_K'">Đề xuất mức giảm giá</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">CK Vòng 2 <br> đạt được <br> chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lợi nhuận chưa VAT</th>
                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th colspan="2">Ron 95 III</th>
                  <th colspan="2">E5 - Ron 92 II</th>
                  <th colspan="2">DO 0.001S</th>
                  <th colspan="2">DO 0.05S</th>
                </ng-container>
              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th rowspan="2">Ron 95 III</th>
                <th rowspan="2">E5 - Ron 92 II</th>
                <th rowspan="2">DO 0.001S</th>
                <th rowspan="2">DO 0.05S</th>
                <th rowspan="2">Tổng <br> chi phí</th>
                <th rowspan="2">CP chung <br> chưa<br> cước vc</th>
                <th rowspan="2">Cước VC <br> bình quân</th>
                <th rowspan="2">Lãi vay <br> NH (đ/l)</th>
                <th>Xăng</th>
                <th>Dầu</th>
                <th colspan="2">Ron 95 III</th>
                <th colspan="2">E5 - Ron 92 II</th>
                <th colspan="2">DO 0.001S</th>
                <th colspan="2">DO 0.05S</th>

                <th rowspan="2">Ron 95 III</th>
                <th rowspan="2">E5 - Ron 92 II</th>
                <th rowspan="2">DO 0.001S</th>
                <th rowspan="2">DO 0.05S</th>
                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                </ng-container>

              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th>Có VAT</th>
                <th>Có VAT</th>

                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
              </tr>

            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.fob;">
                <tr>
                  <td *ngIf="data.isBold"></td>
                  <td *ngIf="data.isBold" nzAlign="left" colspan="36" style="font-weight: bold;">
                    {{data.customerName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('FOB') || data?.customerName?.toLowerCase().includes(getSearchTerm('FOB').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{ data.customerName }}</td>

                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col4 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col5 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col6 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col7 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col8 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col9 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col10 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col11 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col12 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col13 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col14 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col15 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col16 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col17 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col18 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col19 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col20 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col21 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col21) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col22 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col22) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col23 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col23) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col24 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col24) }}
                    </td>

                    <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col25 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col26 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col27 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col28 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col29 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col30 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col31 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col32 | number}}</td>
                    </ng-container>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PT09)" nzTitle="PT09"
        (nzClick)="reset('PT09')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh !important' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pt09">
            <thead>
              <tr>
                <th rowspan="3">TT</th>
                <th rowspan="3">THỊ TRƯỜNG</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lãi gộp chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Chi phí phát sinh chưa có VAT</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">CK điều tiết <br> (-/+)</th>
                <th colspan="8" *ngIf="accountGroups != 'G_NV_K'">Đề xuất mức giảm giá</th>
                <th rowspan="3" *ngIf="accountGroups != 'G_NV_K'">CK Vòng 2 <br> đạt được <br> chưa VAT</th>
                <th colspan="4" *ngIf="accountGroups != 'G_NV_K'">Lợi nhuận chưa VAT</th>

                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th colspan="2">Ron 95 III</th>
                  <th colspan="2">E5 - Ron 92 II</th>
                  <th colspan="2">DO 0.001S</th>
                  <th colspan="2">DO 0.05S</th>
                </ng-container>
              </tr>
              <tr>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Tổng <br> chi phí</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">CP chung <br> chưa<br> cước vc</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Cước VC <br> bình quân</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Lãi vay <br> NH (đ/l)</th>
                <th *ngIf="accountGroups != 'G_NV_K'">Xăng</th>
                <th *ngIf="accountGroups != 'G_NV_K'">Dầu</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th colspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>

                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">Ron 95 III</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">E5 - Ron 92 II</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.001S</th>
                <th rowspan="2" *ngIf="accountGroups != 'G_NV_K'">DO 0.05S</th>

                <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                  <th rowspan="2">CHƯA VAT, BVMT</th>
                  <th rowspan="2">CÓ VAT, BVMT</th>
                </ng-container>

              </tr>
              <tr *ngIf="accountGroups != 'G_NV_K'">
                <th>Có VAT</th>
                <th>Có VAT</th>

                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
                <th>Có VAT</th>
                <th>Chưa có VAT</th>
              </tr>

            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pt09;">
                <tr>
                  <td *ngIf="data.isBold"></td>
                  <td *ngIf="data.isBold" nzAlign="left" colspan="36" style="font-weight: bold;">
                    {{data.customerName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('PT09') || data?.customerName?.toLowerCase().includes(getSearchTerm('PT09').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{ data.customerName }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col4 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col5 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col6 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col7 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col8 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col10 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col11 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col12 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col13 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col14 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col15 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col16 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col17 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col18 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col19 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col20 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col21 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col21) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col22 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col22) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col23 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col23) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col24 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber(data.col24) }}
                    </td>

                    <ng-container *ngIf="accountGroups != 'G_TP_KD'">
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col25 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col26 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col27 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col28 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col29 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col30 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col31 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col32 | number}}</td>
                    </ng-container>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_BB_DO)" nzTitle="BB DO"
        (nzClick)="reset('BBDO')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.bbdo">
            <thead>
              <tr>
                <th class="align-center" rowspan="2">TT</th>
                <th class="align-center" rowspan="2">TÊN KHÁCH HÀNG</th>
                <th class="align-center" rowspan="2">ĐỊA ĐIỂM GIAO HÀNG</th>
                <th class="align-center" rowspan="2">MẶT HÀNG</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" rowspan="2">PHƯƠNG <br> THỨC</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" rowspan="2">MÃ KHÁCH</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" rowspan="2">MÃ <br> HÀNG HOÁ</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" rowspan="2">ĐVT</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" rowspan="2">HẠN <br> THANH <br> TOÁN</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="2">Mức lãi gộp TĐ giao (vùng 2)</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="4">Chi phí tạm tính chưa VAT </th>

                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="2">Đề xuất mức giảm giá <br> tại kho
                  bên bán (FOB)</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="2">Mức giảm giá tại kho bên mua</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="2">LỢI NHUẬN (Đ/Ltt)</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'" colspan="2">GIÁ BÁN CHO KHÁCH HÀNG (Đ/L)</th>
              </tr>
              <tr>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Đã có thuế</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Chưa thuế</th>

                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Tổng <br>chi phí</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">CP chung <br> chưa cước vc</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Cước vận <br> chuyển</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Lãi vay <br> NH, phí <br> bơm rót, ≠</th>

                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Đã có thuế</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Chưa thuế</th>

                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Đã có thuế</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Chưa thuế</th>

                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Đã có thuế</th>
                <th class="align-center" *ngIf="accountGroups != 'G_NV_K'">Chưa thuế</th>

                <th class="align-center">CHƯA VAT, <br> BVMT</th>
                <th class="align-center">CÓ VAT, <br> BVMT</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.bbdo;">
                <tr>
                  <td *ngIf="data.isBold" nzAlign="center" style="font-weight: bold;"></td>
                  <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="22">
                    {{data.customerName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('BBDO') || data?.customerName?.toLowerCase().includes(getSearchTerm('BBDO').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left">{{ data.deliveryPoint}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left">{{ data.goodName}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="left">{{ data.pThuc}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="left">{{ data.customerCode}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="left">{{ data.goodCode}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="left">{{ data.dvt}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="left">{{ data.tToan}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col1 | number:'1.0-0'
                      }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col2 | number:'1.0-0'
                      }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col4 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col5 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col6 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col7 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col8 | number:'1.0-0'
                      }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col9 | number}}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right">{{ data.col10 | number:'1.0-0'
                      }}</td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col11 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber2(data.col11) }}
                    </td>
                    <td *ngIf="!data.isBold && accountGroups != 'G_NV_K'" nzAlign="right"
                      [style.color]="data.col12 < 0 ? 'red' : 'inherit'">{{ _global.formatNegativeNumber2(data.col12) }}
                    </td>
                    <td *ngIf="!data.isBold" nzAlign="right">{{ data.col13 | number:'1.0-0' }}</td>
                    <td *ngIf="!data.isBold" nzAlign="right">{{ data.col14 | number:'1.0-0' }}</td>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PL1)" nzTitle="PL1"
        (nzClick)="reset('PL1')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pl1" style="width: 50%;">
            <thead>
              <tr>
                <th class="align-center" rowspan="3">TT</th>
                <th class="align-center" rowspan="3">VÙNG THỊ TRƯỜNG</th>
                <th class="align-center" colspan="4">MỨC GIẢM GIÁ (ĐÃ CÓ VAT)</th>
              </tr>
              <tr>
                <th class="align-center">Xăng không chì <br> RON 95-III</th>
                <th class="align-center">Xăng sinh học <br> E5 RON 92-II</th>
                <th class="align-center">DO 0,001S-V</th>
                <th class="align-center">DO 0,05S-II</th>
              </tr>
              <tr>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
              </tr>
              <tr>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pl1;">
                <tr>
                  <td *ngIf="data.isBold" nzAlign="center" style="font-weight: bold;">{{data.stt}}</td>
                  <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="5"
                    title="{{data.marketName}}">
                    {{data.marketName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('PL1') || data?.marketName?.toLowerCase().includes(getSearchTerm('PL1').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.marketName}}">{{data.marketName}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4 | number}}</td>
                  </ng-container>
                </tr>
              </ng-container>

            </tbody>
          </nz-table>
        </div>
      </nz-tab>
      <!-- #endregion PL1 -->

      <!-- #region PL2 -->
      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PL2)" nzTitle="PL2"
        (nzClick)="reset('PL2')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pl2" style="width: 50%;">
            <thead>
              <tr>
                <th class="align-center" rowspan="3">TT</th>
                <th class="align-center" rowspan="3">VÙNG THỊ TRƯỜNG</th>
                <th class="align-center" colspan="4">MỨC GIẢM GIÁ (ĐÃ CÓ VAT)</th>
              </tr>
              <tr>
                <th class="align-center">Xăng không chì <br> RON 95-III</th>
                <th class="align-center">Xăng sinh học <br> E5 RON 92-II</th>
                <th class="align-center">DO 0,001S-V</th>
                <th class="align-center">DO 0,05S-II</th>
              </tr>
              <tr>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
              </tr>
              <tr>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pl2;">
                <tr>
                  <td *ngIf="data.isBold" nzAlign="center" style="font-weight: bold;">{{data.stt}}</td>
                  <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="5"
                    title="{{data.customerName}}">
                    {{data.customerName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('PL2') || data?.customerName?.toLowerCase().includes(getSearchTerm('PL2').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4 | number}}</td>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>
      <!-- #endregion PL2 -->

      <!-- #region PL3 -->
      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PL3)" nzTitle="PL3"
        (nzClick)="reset('PL3')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pl3" style="width: 70%;">
            <thead>
              <tr>
                <th class="align-center" rowspan="3">TT</th>
                <th class="align-center" rowspan="3">TÊN KHÁCH HÀNG</th>
                <th class="align-center" colspan="4">MỨC GIẢM GIÁ (ĐÃ CÓ VAT)</th>
              </tr>
              <tr>
                <th class="align-center">Xăng không chì <br> RON 95-III</th>
                <th class="align-center">Xăng sinh học <br> E5 RON 92-II</th>
                <th class="align-center">DO 0,001S-V</th>
                <th class="align-center">DO 0,05S-II</th>
              </tr>
              <tr>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
              </tr>
              <tr>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pl3;">
                <tr
                  *ngIf="!getSearchTerm('PL3') || data?.customerName?.toLowerCase().includes(getSearchTerm('PL3').toLowerCase())">
                  <td nzAlign="center">{{data.stt}}</td>
                  <td nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                  <td nzAlign="center">{{ data.col1 | number}}</td>
                  <td nzAlign="center">{{ data.col2 | number}}</td>
                  <td nzAlign="center">{{ data.col3 | number}}</td>
                  <td nzAlign="center">{{ data.col4 | number}}</td>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>
      <!-- #endregion PL3 -->

      <!-- #region PL4 -->
      <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PL4)" nzTitle="PL4"
        (nzClick)="reset('PL4')">
        <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
          <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
            [nzData]="output.pl4" style="width: 50%;">
            <thead>
              <tr>
                <th class="align-center" rowspan="3">TT</th>
                <th class="align-center" rowspan="3">VÙNG THỊ TRƯỜNG</th>
                <th class="align-center" colspan="4">MỨC GIẢM GIÁ (ĐÃ CÓ VAT)</th>
              </tr>
              <tr>
                <th class="align-center">Xăng không chì <br> RON 95-III</th>
                <th class="align-center">Xăng sinh học <br> E5 RON 92-II</th>
                <th class="align-center">DO 0,001S-V</th>
                <th class="align-center">DO 0,05S-II</th>
              </tr>
              <tr>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
                <th class="align-center">đ/lít tt</th>
              </tr>
              <tr>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let data of output.pl4;">
                <tr>
                  <td *ngIf="data.isBold" nzAlign="center" style="font-weight: bold;">{{data.stt}}</td>
                  <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="5"
                    title="{{data.customerName}}">
                    {{data.marketName}}</td>
                  <ng-container
                    *ngIf="!getSearchTerm('PL4') || data?.marketName?.toLowerCase().includes(getSearchTerm('PL4').toLowerCase())">
                    <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                    <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3 | number}}</td>
                    <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4 | number}}</td>
                  </ng-container>
                </tr>
              </ng-container>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>
      <!-- #endregion PL4 -->

      <ng-container *ngIf="accountGroups != 'G_TP_KD'">
        <!-- #region VK11 PT -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_VK11_PT)" nzTitle="VK11 PT"
          (nzClick)="reset('VK11PT')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.vk11Pt">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.vk11Pt;">
                  <tr>
                    <td *ngIf="data.isBold"></td>
                    <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="18"
                      title="{{data.customerName}}">
                      {{data.customerName}}</td>
                    <ng-container
                      *ngIf="!getSearchTerm('VK11PT') || data?.customerName?.toLowerCase().includes(getSearchTerm('VK11PT').toLowerCase())">
                      <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col5}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col6}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col7}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col8 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col9}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col10}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col11}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col12}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col13}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col14}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col15}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion VK11 PT -->

        <!-- #region VK11 ĐB -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_VK11_DB)" nzTitle="VK11 ĐB"
          (nzClick)="reset('VK11DB')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.vk11Db">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center">ĐỊA CHỈ</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.vk11Db;">
                  <tr>
                    <td *ngIf="data.isBold"></td>
                    <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="18"
                      title="{{data.customerName}}">
                      {{data.customerName}}</td>
                    <ng-container
                      *ngIf="!getSearchTerm('VK11DB') || data?.customerName?.toLowerCase().includes(getSearchTerm('VK11DB').toLowerCase())">
                      <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col5}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col6}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col7}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col8 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col9}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col10}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col11}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col12}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col13}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col14}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col15}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion VK11 ĐB -->

        <!-- #region VK11 FOB -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_VK11_FOB)" nzTitle="VK11 FOB"
          (nzClick)="reset('VK11FOB')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.vk11Fob">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center">ĐỊA CHỈ</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.vk11Fob;">
                  <tr>
                    <td *ngIf="data.isBold"></td>
                    <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="18"
                      title="{{data.customerName}}">
                      {{data.customerName}}</td>
                    <ng-container
                      *ngIf="!getSearchTerm('VK11FOB') || data?.customerName?.toLowerCase().includes(getSearchTerm('VK11FOB').toLowerCase())">
                      <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col5}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col6}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col7}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col8 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col9}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col10}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col11}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col12}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col13}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col14}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col15}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion VK11 FOB -->

        <!-- #region VK11 TNPP -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_VK11_TNPP)" nzTitle="VK11 TNPP"
          (nzClick)="reset('VK11TNPP')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.vk11Tnpp">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center" colspan="2">VÙNG CHXD</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.vk11Tnpp;">
                  <tr>
                    <td *ngIf="data.isBold"></td>
                    <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="18"
                      title="{{data.customerName}}">
                      {{data.customerName}}</td>
                    <ng-container
                      *ngIf="!getSearchTerm('VK11TNPP') || data?.customerName?.toLowerCase().includes(getSearchTerm('VK11TNPP').toLowerCase())">
                      <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col5}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col6}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col7}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col8 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col9}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col10}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col11}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col12}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col13}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col14}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col15}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion VK11 TNPP -->

        <!-- #region PTS -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_PTS)" nzTitle="PTS"
          (nzClick)="reset('PTS')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.pts">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">KHÁCH HÀNG</th>
                  <th class="align-center">MẶT HÀNG</th>
                  <th class="align-center">DVT</th>
                  <th class="align-center">GIÁ CHƯA VAT&BVMT</th>
                  <th class="align-center">THỜI HẠN THANH TOÁN</th>
                  <th class="align-center">NGÀY HIỆU LỰC</th>
                  <th class="align-center">ĐẾN</th>
                  <th class="align-center">ĐIỂM GIAO HÀNG</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.pts;">
                  <tr
                    *ngIf="!getSearchTerm('PTS') || data?.marketName?.toLowerCase().includes(getSearchTerm('PTS').toLowerCase())">
                    <td nzAlign="center">{{data.stt}}</td>
                    <td nzAlign="left">{{data.pThuc}}</td>
                    <td nzAlign="left">{{data.customerCode}}</td>
                    <td nzAlign="left">{{ data.goodCode}}</td>
                    <td nzAlign="left">L15</td>
                    <td nzAlign="center">{{ data.col3 }}</td>
                    <td nzAlign="center">{{ data.tToan }}</td>
                    <td nzAlign="center">{{ data.marketName }}</td>
                    <td nzAlign="center">31.12.9999</td>
                    <td nzAlign="center">{{ data.deliveryPoint }}</td>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion PTS -->

        <!-- #region VK11 BB -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_VK11_BB)" nzTitle="VK11 BB"
          (nzClick)="reset('VK11BB')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.vk11Bb">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center">ĐIỂM GIAO HÀNG</th>
                  <th class="align-center">MẶT HÀNG</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.vk11Bb;">
                  <tr
                    *ngIf="!getSearchTerm('VK11BB') || data?.customerName.toLowerCase().includes(getSearchTerm('VK11BB').toLowerCase())">
                    <td nzAlign="center">{{data.stt}}</td>
                    <td nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                    <td nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                    <td nzAlign="left">{{ data.goodsName}}</td>
                    <td nzAlign="center">{{ data.col1 | number}}</td>
                    <td nzAlign="center">{{ data.col2 | number}}</td>
                    <td nzAlign="center">{{ data.col3}}</td>
                    <td nzAlign="center">{{ data.col4}}</td>
                    <td nzAlign="center">{{ data.col5}}</td>
                    <td nzAlign="center">{{ data.col6}}</td>
                    <td nzAlign="center">{{ data.col7}}</td>
                    <td nzAlign="right">{{ data.col8 | number}}</td>
                    <td nzAlign="center">{{ data.col9}}</td>
                    <td nzAlign="center">{{ data.col10}}</td>
                    <td nzAlign="center">{{ data.col11}}</td>
                    <td nzAlign="center">{{ data.col12}}</td>
                    <td nzAlign="center">{{ data.col13}}</td>
                    <td nzAlign="center">{{ data.col14}}</td>
                    <td nzAlign="center">{{ data.col15}}</td>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
        <!-- #endregion VK11 BB -->

        <!-- #region Tổng hợp -->
        <nz-tab *ngIf="rightList.includes(IMPORT_BATCH.WATCH_IMPORT_BATCH_LIST_TONG_HOP)" nzTitle="Tổng hợp"
          (nzClick)="reset('TH')">
          <div [ngStyle]="{
          overflow: 'auto',
          height: isZoom ? '100vh' : 'calc(100vh - 206px)',
        }">
            <nz-table [nzShowPagination]="false" nzSize="small" [nzFrontPagination]="false" nzBordered
              [nzData]="output.summary">
              <thead>
                <tr>
                  <th class="align-center">TT</th>
                  <th class="align-center">TÊN KHÁCH HÀNG ĐẠI LÝ</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">VÙNG CHXD</th>
                  <th class="align-center">CỰ LY <br> V/C km</th>
                  <th class="align-center">ĐƠN GIÁ <br> CƯỚC đ/l</th>
                  <th class="align-center">P THỨC</th>
                  <th class="align-center">MÃ KHÁCH</th>
                  <th class="align-center">MÃ HÀNG</th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center">THỜI HẠN TT</th>
                  <th class="align-center">GIÁ CHƯA <br> VAT&BVMT</th>
                  <th class="align-center"></th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐVT</th>
                  <th class="align-center"></th>
                  <th class="align-center">HIỆU LỰC TỪ</th>
                  <th class="align-center"></th>
                  <th class="align-center">ĐẾN</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of output.summary;">
                  <tr>
                    <td *ngIf="data.isBold"></td>
                    <td *ngIf="data.isBold" style="font-weight: bold;" nzAlign="left" colspan="18"
                      title="{{data.customerName}}">
                      {{data.customerName}}</td>
                    <ng-container
                      *ngIf="!getSearchTerm('TH') || data?.customerName?.toLowerCase().includes(getSearchTerm('TH').toLowerCase())">
                      <td *ngIf="!data.isBold" nzAlign="center">{{data.stt}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.customerName}}">{{data.customerName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left" title="{{data.address}}">{{ data.address}}</td>
                      <td *ngIf="!data.isBold" nzAlign="left">{{ data.marketName}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col1 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col2 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col3}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col4}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col5}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col6}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col7}}</td>
                      <td *ngIf="!data.isBold" nzAlign="right">{{ data.col8 | number}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col9}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col10}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col11}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col12}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col13}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col14}}</td>
                      <td *ngIf="!data.isBold" nzAlign="center">{{ data.col15}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
          </div>
        </nz-tab>
      </ng-container>
      <!-- #endregion Tổng hợp -->

    </nz-tabset>
  </div>
</div>

<!-- danh sach trình ký -->
<nz-modal [(nzVisible)]="isVisibleLstTrinhKy" nzTitle="CHỌN TRÌNH KÝ" (nzOnCancel)="exportWordTrinhKy()"
  (nzOnOk)="confirmExportWordTrinhKy()" nzCancelText="Đóng">
  <ng-container *nzModalContent>
    <nz-table #customerTable [nzData]="lstTrinhKy" nzSize="small">
      <thead>
        <tr>
          <th [(nzChecked)]="checked" (nzCheckedChange)="onAllCheckedLstTrinhKy($event)"></th>
          <td style="font-weight:bold">Xuất trình ký</td>
        </tr>
      </thead>
      <tbody>
        @for (data of lstTrinhKy; track data) {
        <tr *ngIf="input.header.status != '04' ? data.status == true : true">
          <td [nzChecked]="lstTrinhKyChecked.includes(data.code)"
            (nzCheckedChange)="onItemTrinhKyChecked(data.code, $event)"></td>
          <td>{{ data.name }}</td>
        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>

<!-- danh sách sms -->
<nz-modal [(nzVisible)]="isSms" nzTitle="CHỌN MẪU SMS" (nzOnCancel)="handleCancel()" nzCancelText="Đóng">
  <ng-container *nzModalContent>
    <nz-table #smsTable [nzData]="lstSms" nzSize="small">
      <thead>
        <tr>
          <th style="font-weight:bold"> Mẫu SMS</th>
        </tr>
      </thead>
      <tbody>
        <nz-radio-group [(ngModel)]="smsName" style="width : 100%" nzSize="large">
          <ng-container *ngFor="let data of smsTable.data">
            <!-- <tr style="width : 100%" > -->
            <!-- <td style="text-align: left; width: 100%;"> -->
            <label nz-radio [nzValue]="data.name" style="width : 100%">{{ data.name }}</label>
            <!-- </td> -->
            <!-- </tr> -->
          </ng-container>
        </nz-radio-group>
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>


<!-- Customer -->
<nz-modal [(nzVisible)]="isVisibleCustomer" nzTitle="CHỌN KHÁCH HÀNG" (nzOnCancel)="handleCancel()"
  [nzFooter]="nzModalFooter">
  <ng-container *nzModalContent>
    <nz-table #customerTable [nzData]="lstCus" nzSize="small">
      <thead>
        <tr>
          <th [(nzChecked)]="checked" (nzCheckedChange)="onAllChecked($event)"></th>
          <td style="font-weight:bold"><input nz-input [(ngModel)]="inputSearchCustomer" placeholder="Tên khách hàng"
              (ngModelChange)="searchCustomer()" type="text" />
          </td>
        </tr>
      </thead>
      <tbody>
        @for (data of customerTable.data; track data) {
        <tr>
          <td [nzChecked]="isChecked(data.code)"
            (nzCheckedChange)="onItemChecked(data.code, data.deliveryGroupCode, $event)">
          </td>
          <td>{{ data.name }}</td>
        </tr>
        }
      </tbody>
    </nz-table>

  </ng-container>
</nz-modal>
<ng-template #nzModalFooter>
  <div style="display: flex; justify-content: flex-end;">
    <nz-space [nzSize]="5">
      <button nz-button nzType="default" (click)="handleCancel()">Đóng</button>
      <button nz-button nzType="primary" (click)="confirmExportWord()" [nzLoading]="isConfirmLoading">Tải file
        về</button>
      <button nz-button nzType="primary" (click)="confirmExportWordMail()" [nzLoading]="isConfirmLoading">Tạo file đính
        kèm mail</button>
    </nz-space>
  </div>
</ng-template>

<nz-modal [(nzVisible)]="isVisibleCustomerPDF" nzTitle="CHỌN KHÁCH HÀNG" (nzOnCancel)="handleCancel()"
  (nzOnOk)="confirmExportPDF()" nzCancelText="Đóng">
  <ng-container *nzModalContent>
    <nz-table #customerTable [nzData]="lstCustomer" nzSize="small">
      <thead>
        <tr>
          <th [(nzChecked)]="checked" (nzCheckedChange)="onAllChecked($event)"></th>
          <td style="font-weight:bold">Tên khách hàng</td>
        </tr>
      </thead>
      <tbody>
        @for (data of customerTable.data; track data) {
        <tr>
          <td [nzChecked]="isChecked(data.code)"
            (nzCheckedChange)="onItemChecked(data.code, data.deliveryGroupCode, $event)">
          </td>
          <td>{{ data.name }}</td>
        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>

<!-- #region Dữ liệu đầu vào -->
<nz-drawer nzWidth="80%" nzSize="default" [nzVisible]="visibleInput" nzPlacement="right" [nzTitle]="'DỮ LIỆU ĐỢT TÍNH'"
  [nzExtra]="extra" (nzOnClose)="close()">
  <ng-container *nzDrawerContent>
    <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-bottom: 10px;">
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Tên đợt tính</label>
          <input nz-input placeholder="Nhập tên đợt tính" [(ngModel)]="input.header.name" type="text" />
        </div>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Ngày hiệu lực</label>
          <nz-date-picker nzShowTime (ngModelChange)="onDateChange($event)" nzFormat="yyyy-MM-dd HH:mm"
            [(ngModel)]="input.header.date" [nzPlaceHolder]="'Chọn ngày'" style="width: 100%;"></nz-date-picker>
        </div>
      </div>

      <div nz-col class="gutter-row" [nzSpan]="4">
        <div class="inner-box">
          <label>Giờ hiệu lực giá bán lẻ</label>
          <nz-time-picker nzShowTime (ngModelChange)="onDateChange($event)" nzFormat="HH:mm"
            [(ngModel)]="input.header.hour" [nzPlaceHolder]="'Chọn giờ'" style="width: 100%;"></nz-time-picker>
        </div>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="8">
        <label>Tìm kiếm</label>
        <!-- <ng-container> -->
        <div style="width:100%; display: flex;">
          <input nz-input placeholder="Tìm kiếm dữ liệu đầu vào" (keydown.enter)="searchInPutDb(currentTabInput)"
            [(ngModel)]="searchInputTab" type="text">
          <button (click)="searchInPutDb(currentTabInput)" class="flex !items-center !border-l-0 gray-btn"
            nzType="default" nz-button nzType="default">
            <span nz-icon nzType="search"></span>
          </button>
        </div>
        <!-- </ng-container> -->
      </div>
    </div>

    <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-bottom: 10px;">

      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Quyết định giá bán lẻ số</label>
          <input nz-input [(ngModel)]="input.header.quyetDinhSo" #nameInput="ngModel" required />
        </div>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Công điện giá bán nội bộ số</label>
          <input nz-input [(ngModel)]="input.header.congDienSo" #nameInput="ngModel" required />
        </div>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Công điện GBNB áp dụng PTBL</label>
          <input nz-input [(ngModel)]="input.header.congDienPtBanLe" #nameInput="ngModel" required />
        </div>
      </div>

      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>VB điều chỉnh hệ số VCF</label>
          <input nz-input [(ngModel)]="input.header.thueBvmtPts" #nameInput="ngModel" required />
        </div>
      </div>
    </div>

    <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" style="margin-bottom: 10px;">
      <div nz-col [nzSpan]="6">
        <label>Người ký</label>
        <nz-form-item>
          <nz-form-control nzErrorTip="Không được để trống">
            <nz-select nzShowSearch nzAllowClear [nzPlaceHolder]="'Chọn người ký'"
              [(ngModel)]="input.header.signerCode">
              @for (item of signerResult; track item) {
              @if (item.type === 'NguoiKy') {
              <nz-option [nzLabel]="item.position + ' - ' + item.name" [nzValue]="item.code"></nz-option>
              }
              }
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Viết phương án</label>
          <nz-form-item>
            <nz-form-control nzErrorTip="Không được để trống">
              <nz-select nzShowSearch nzAllowClear [nzPlaceHolder]="'Chọn người ký'"
                [(ngModel)]="input.header.vietphuonganCode">
                @for (item of signerResult; track item) {
                @if (item.type === 'vietPhuongAn') {
                <nz-option [nzLabel]="item.position + ' - ' + item.name" [nzValue]="item.code"></nz-option>
                }
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Phòng KDXD</label>
          <nz-form-item>
            <nz-form-control nzErrorTip="Không được để trống">
              <nz-select nzShowSearch nzAllowClear [nzPlaceHolder]="'Chọn người ký'"
                [(ngModel)]="input.header.kdxdCode">
                @for (item of signerResult; track item) {
                @if (item.type === 'kdxd') {
                <nz-option [nzLabel]="item.position + ' - ' + item.name" [nzValue]="item.code"></nz-option>
                }
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-col class="gutter-row" [nzSpan]="6">
        <div class="inner-box">
          <label>Phòng TCKT</label>
          <nz-form-item>
            <nz-form-control nzErrorTip="Không được để trống">
              <nz-select nzShowSearch nzAllowClear [nzPlaceHolder]="'Chọn người ký'"
                [(ngModel)]="input.header.tcktCode">
                @for (item of signerResult; track item) {
                @if (item.type === 'tckt') {
                <nz-option [nzLabel]="item.position + ' - ' + item.name" [nzValue]="item.code"></nz-option>
                }
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </div>

    <nz-tabset [(nzSelectedIndex)]="selectedIndexInput" (nzSelectedIndexChange)="onTabChangeInput($event)">
      <nz-tab nzTitle="THÔNG TIN GIÁ" (nzClick)="resetInput('inputPrice')">
        <nz-table nzBordered nzSize="small" [nzData]="input2.inputPrice" [nzFrontPagination]="false"
          [nzShowPagination]="false" *ngIf="selectedIndexInput == 0">
          <thead>
            <tr>
              <th nzAlign="center" rowspan="2">LOẠI HÀNG</th>
              <th nzAlign="center" rowspan="2">THUẾ BVMT</th>
              <th nzAlign="center" rowspan="2">Hệ số <br> VCF BQ <br> mùa miền</th>
              <th nzAlign="center" rowspan="2">MỨC TĂNG<br> SO VỚI V1</th>
              <th nzAlign="center" colspan="2">GIÁ TẬP ĐOÀN CÔNG BỐ</th>
              <th nzAlign="center" rowspan="2">L15 CHƯA VAT<br> & BVMT<br>(PT bán lẻ - V2)</th>
              <th nzAlign="center" rowspan="2">L15 CHƯA VAT <br> & BVMT<br>(ngoài bán lẻ)</th>
              <th nzAlign="center" rowspan="2">LÃI GỘP ĐIỀU TIẾT<br>(L15 CHƯA VAT&BVMT)</th>
              <th nzAlign="center" rowspan="2">GIẢM GIÁ FOB <br> CÓ VAT &BVMT <br>(Vùng còn lại)</th>
              <th nzAlign="center" rowspan="2">GIẢM GIÁ FOB <br> CÓ VAT &BVMT <br> (Vùng trung tâm)</th>
            </tr>
            <tr>
              <th nzAlign="center">GIÁ BÁN LẺ V1</th>
              <th nzAlign="center">GIÁ BÁN LẺ V2</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of input2.inputPrice; let rowIndex = index">
              <ng-container
                *ngIf="!getSearchTermInput('inputPrice') || data?.goodName?.toLowerCase().includes(getSearchTermInput('inputPrice').trim().toLowerCase())">
                <td>{{ data.goodName }}</td>
                <td><input nz-input [(ngModel)]="data.thueBvmt" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'thueBvmt')"
                    type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.vcf" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'vcf')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.chenhLech" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'chenhLech')"
                    type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.gblV1" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'gblV1')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.gblV2" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'gblV2')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.l15Blv2" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'l15Blv2')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.l15Nbl" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'l15Nbl')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.laiGop" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'laiGop')" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.fobV2" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'fobV2')"
                    (keyup)="handleAutoInput(data)" type="text" />
                </td>
                <td><input nz-input [(ngModel)]="data.fobV1" style="text-align: right;"
                    (keydown)="onKeyDownNumberOnly($event)" (input)="onInputNumberFormat(data,'fobV1')" type="text" />
                </td>
              </ng-container>
            </tr>
          </tbody>
        </nz-table>
      </nz-tab>

      <nz-tab nzTitle="THỊ TRƯỜNG" (nzClick)="resetInput('market')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.market" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'" *ngIf="selectedIndexInput == 1">
            <thead>
              <tr>
                <th nzAlign="center" rowspan="2">THỊ TRƯỜNG</th>
                <th nzAlign="center" rowspan="2">CỰ LY BQ (Km)</th>
                <th nzAlign="center" rowspan="2">CƯỚC VC BQ</th>
                <th nzAlign="center" rowspan="2">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center" colspan="2">CK ĐIỀU TIẾT</th>
              </tr>
              <tr>
                <th nzAlign="center">XĂNG</th>
                <th nzAlign="center">DẦU</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of input.market">
                <ng-container
                  *ngIf="!getSearchTermInput('market') || data?.name?.toLowerCase().includes(getSearchTermInput('market').trim().toLowerCase())">
                  <td>{{data.name }}</td>
                  <td><input nz-input [(ngModel)]="data.gap" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cuocVCBQ" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpChungChuaCuocVC" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDieuTietXang" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDieuTietDau" type="number" /></td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab nzTitle="KHÁCH HÀNG PT" (nzClick)="resetInput('customerPt')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.customerPt" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'" *ngIf="selectedIndexInput == 2">
            <thead>
              <tr>
                <th nzAlign="center" rowspan="2">MÃ</th>
                <th nzAlign="center" rowspan="2">KHÁCH HÀNG</th>
                <th nzAlign="center" rowspan="2">CỰ LY <br> BQ (Km)</th>
                <th nzAlign="center" rowspan="2">CƯỚC <br> VC BQ</th>
                <th nzAlign="center" rowspan="2">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center" colspan="2">CK ĐIỀU TIẾT</th>
                <th nzAlign="center" rowspan="2">HỖ TRỢ <br> CƯỚC VC</th>
                <th nzAlign="center" rowspan="2">NGUỒN LỰC <br> HỖ TRỢ</th>
                <th nzAlign="center" rowspan="2">CK <br> VÒNG 2</th>
                <th nzAlign="center" rowspan="2">LÃI VAY NH</th>
                <th nzAlign="center" rowspan="2" style="width: 24%;">ĐỊA CHỈ</th>
              </tr>
              <tr>
                <th nzAlign="center">XĂNG</th>
                <th nzAlign="center">DẦU</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of input.customerPt">
                <ng-container
                  *ngIf="!getSearchTermInput('customerPt') || data?.name?.toLowerCase().includes(getSearchTermInput('customerPt').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td><input nz-input [(ngModel)]="data.cuLyBq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cvcbq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpccvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckXang" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDau" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.htcvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.httVb1370" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckv2" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.lvnh" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.adrress" type="text" /></td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab nzTitle="KHÁCH HÀNG ĐB" (nzClick)="resetInput('customerDb')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.customerDb" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'" *ngIf="selectedIndexInput == 3">
            <thead>
              <tr>
                <th nzAlign="center" rowspan="2">MÃ</th>
                <th nzAlign="center" rowspan="2">KHÁCH HÀNG</th>
                <th nzAlign="center" rowspan="2">CỰ LY <br> BQ (Km)</th>
                <th nzAlign="center" rowspan="2">CƯỚC <br> VC BQ</th>
                <th nzAlign="center" rowspan="2">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center" colspan="2">CK ĐIỀU TIẾT</th>
                <th nzAlign="center" rowspan="2">HỖ TRỢ <br> CƯỚC VC</th>
                <th nzAlign="center" rowspan="2">NGUỒN LỰC <br> HỖ TRỢ</th>
                <th nzAlign="center" rowspan="2">CK <br> VÒNG 2</th>
                <th nzAlign="center" rowspan="2">LÃI VAY NH</th>
                <th nzAlign="center" rowspan="2" style="width: 24%;">ĐỊA CHỈ</th>
              </tr>
              <tr>
                <th nzAlign="center">XĂNG</th>
                <th nzAlign="center">DẦU</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of input.customerDb">
                <ng-container
                  *ngIf="!getSearchTermInput('customerDb') || data?.name?.toLowerCase().includes(getSearchTermInput('customerDb').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td><input nz-input [(ngModel)]="data.cuLyBq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cvcbq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpccvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckXang" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDau" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.htcvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.httVb1370" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckv2" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.lvnh" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.adrress" type="text" /></td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab nzTitle="KHÁCH HÀNG FOB" (nzClick)="resetInput('customerFob')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.customerFob" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'" *ngIf="selectedIndexInput == 4">
            <thead>
              <tr>
                <th nzAlign="center" rowspan="2">MÃ</th>
                <th nzAlign="center" rowspan="2">KHÁCH HÀNG</th>
                <th nzAlign="center" rowspan="2">CỰ LY <br> BQ (Km)</th>
                <th nzAlign="center" rowspan="2">CƯỚC <br> VC BQ</th>
                <th nzAlign="center" rowspan="2">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center" colspan="2">CK ĐIỀU TIẾT</th>
                <th nzAlign="center" rowspan="2">HỖ TRỢ <br> CƯỚC VC</th>
                <th nzAlign="center" rowspan="2">NGUỒN LỰC <br> HỖ TRỢ</th>
                <th nzAlign="center" rowspan="2">CK <br> VÒNG 2</th>
                <th nzAlign="center" rowspan="2">LÃI VAY NH</th>
                <th nzAlign="center" rowspan="2" style="width: 24%;">ĐỊA CHỈ</th>
              </tr>
              <tr>
                <th nzAlign="center">XĂNG</th>
                <th nzAlign="center">DẦU</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of input.customerFob">
                <ng-container
                  *ngIf="!getSearchTermInput('customerFob') || data?.name?.toLowerCase().includes(getSearchTermInput('customerFob').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td><input nz-input [(ngModel)]="data.cuLyBq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cvcbq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpccvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckXang" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDau" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.htcvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.httVb1370" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckv2" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.lvnh" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.adrress" type="text" /></td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab nzTitle="KHÁCH HÀNG TNPP" (nzClick)="resetInput('customerTnpp')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.customerTnpp" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'"  *ngIf="selectedIndexInput == 5">
            <thead>
              <tr>
                <th nzAlign="center" rowspan="2">MÃ</th>
                <th nzAlign="center" rowspan="2">KHÁCH HÀNG</th>
                <th nzAlign="center" rowspan="2">CỰ LY <br> BQ (Km)</th>
                <th nzAlign="center" rowspan="2">CƯỚC <br> VC BQ</th>
                <th nzAlign="center" rowspan="2">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center" colspan="2">CK ĐIỀU TIẾT</th>
                <th nzAlign="center" rowspan="2">HỖ TRỢ <br> CƯỚC VC</th>
                <th nzAlign="center" rowspan="2">NGUỒN LỰC <br> HỖ TRỢ</th>
                <th nzAlign="center" rowspan="2">CK <br> VÒNG 2</th>
                <th nzAlign="center" rowspan="2">LÃI VAY NH</th>
                <th nzAlign="center" rowspan="2" style="width: 24%;">ĐỊA CHỈ</th>
              </tr>
              <tr>
                <th nzAlign="center">XĂNG</th>
                <th nzAlign="center">DẦU</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of input.customerTnpp">
                <ng-container
                  *ngIf="!getSearchTermInput('customerTnpp') || data?.name?.toLowerCase().includes(getSearchTermInput('customerTnpp').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td><input nz-input [(ngModel)]="data.cuLyBq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cvcbq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpccvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckXang" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckDau" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.htcvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.httVb1370" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.ckv2" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.lvnh" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.adrress" type="text" /></td>
                </ng-container>
              </tr>

            </tbody>
          </nz-table>
        </div>
      </nz-tab>

      <nz-tab nzTitle="KHÁCH HÀNG BBDO" (nzClick)="resetInput('listNameBBDO')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="listNameBBDO" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'"  *ngIf="selectedIndexInput == 6">
            <thead>
              <tr>
                <th nzAlign="center">MÃ</th>
                <th nzAlign="center">KHÁCH HÀNG</th>
                <th nzAlign="center">Vùng</th>
                <th nzAlign="center">CƯỚC <br> VC BQ</th>
                <th nzAlign="center">CP CHUNG <br> CHƯA CƯỚC VC</th>
                <th nzAlign="center">MỨC GIẢM GIÁ TẠI <br> KHO BÊN BÁN (FOB)</th>
                <th nzAlign="center">LÃI VAY NH</th>
                <th nzAlign="center" style="width: 24%;">ĐIỂM GIAO HÀNG</th>
                <th nzAlign="center">LÀM TRÒN <br> ĐẶC BIỆT</th>
              </tr>
            </thead>
            <tbody>

              <tr *ngFor="let data of listNameBBDO">
                <ng-container
                  *ngIf="!getSearchTermInput('listNameBBDO') || data?.name?.toLowerCase().includes(getSearchTermInput('listNameBBDO').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td>
                    <!-- <input nz-input [(ngModel)]="data.localCode" type="text" /> -->
                    <!-- <nz-form-control>
                      <nz-select class="no-border-select" [(ngModel)]="data.localCode">
                        <nz-option  [nzLabel]="'Vùng 1'" [nzValue]="'V1'"> </nz-option>
                        <nz-option  [nzLabel]="'Vùng 2'" [nzValue]="'V2'"></nz-option>
                      </nz-select>
                    </nz-form-control> -->

                    <nz-radio-group [(ngModel)]="data.localCode">
                      <label nz-radio nzValue="V1">V1</label>
                      <label nz-radio nzValue="V2">V2</label>
                    </nz-radio-group>
                  </td>
                  <td><input nz-input [(ngModel)]="data.cvcbq" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.cpccvc" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.fob" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.lvnh" type="number" /></td>
                  <td><input nz-input [(ngModel)]="data.deliveryPoint" type="text" /></td>
                  <td style="text-align: center;">
                    <label nz-checkbox [(ngModel)]="data.lamTronDacBiet"></label>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>


      <nz-tab nzTitle="KHÁCH HÀNG PTS" (nzClick)="resetInput('customerPts')">
        <div class="overflow-input">
          <nz-table nzBordered nzSize="small" [nzData]="input.customerPts" [nzFrontPagination]="'false'"
            [nzShowPagination]="'false'" *ngIf="selectedIndexInput == 7">
            <thead>
              <tr>
                <th nzAlign="center">MÃ</th>
                <th nzAlign="center">KHÁCH HÀNG</th>
                <th nzAlign="center">MẶT HÀNG</th>
                <th nzAlign="center">THỜI HẠN THANH TOÁN</th>
                <th nzAlign="center">PHƯƠNG THỨC</th>
              </tr>
            </thead>
            <tbody>

              <tr *ngFor="let data of input.customerPts">
                <ng-container
                  *ngIf="!getSearchTermInput('customerPts') || data?.name?.toLowerCase().includes(getSearchTermInput('customerPts').trim().toLowerCase())">
                  <td>{{data.code }}</td>
                  <td>{{data.name }}</td>
                  <td nzAlign="center"><input nz-input [(ngModel)]="data.goodsCode" type="number" /></td>
                  <td nzAlign="center"><input nz-input [(ngModel)]="data.thtt" type="text" /></td>
                  <td><input nz-input [(ngModel)]="data.phuongThuc" type="text" /></td>
                </ng-container>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </nz-tab>
    </nz-tabset>
  </ng-container>
</nz-drawer>


<ng-template #extra>
  <nz-space>
    <ng-container>
      <button [nzLoading]="loading" *nzSpaceItem nz-button nzType="primary" class="!flex !items-center"
        (click)="onUpdateInput()" [appPermission]="IMPORT_BATCH.UPDATE_IMPORT_BATCH"
        [disabled]="input.header.status != 01 && input.header.status != 03 && input.header.status != 04 && input.header.status != 07">
        <span nz-icon nzType="save" nzTheme="outline"></span> Cập nhật
      </button>
    </ng-container>
  </nz-space>
</ng-template>

<!-- #endregion Dữ liệu đầu vào -->


<!-- History -->
<nz-modal nzWidth="60%" nzHeight="60%" [(nzVisible)]="isVisibleHistory" nzTitle="LỊCH SỬ THỰC HIỆN"
  (nzOnCancel)="handleCancel()" nzCancelText="Đóng" nzFooter=" ">
  <ng-container *nzModalContent>
    <nz-table #historyTable [nzData]="lstHistory" nzSize="small" [nzFrontPagination]="'false'"
      [nzShowPagination]="'false'">
      <thead>
        <tr>
          <th>Hành động</th>
          <th>Người cập nhật</th>
          <th>Thời gian cập nhật</th>
          <th>Nội dung</th>
        </tr>
      </thead>
      <tbody>
        @for (data of historyTable.data; track data) {
        <tr>
          <td>{{ data.action }}</td>
          <td class="align-center">{{ data.createBy }}</td>
          <td class="align-center">
            {{ data.createDate | date: 'dd/MM/yyyy hh:mm' }}
          </td>
          <td>{{ data.contents }}</td>
        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>

<!-- SMS -->
<nz-modal nzWidth="75%" [(nzVisible)]="isVisibleSms" nzTitle="LỊCH SỬ GỬI SMS" (nzOnCancel)="handleCancel()"
  [nzFooter]="modalFooter">
  <ng-container *nzModalContent>
    <nz-table #historyTable [nzData]="lstSearchSms" nzSize="small">
      <thead>
        <tr>
          <th [(nzChecked)]="checkedSms" (nzCheckedChange)="onAllCheckedSendSms($event)"></th>
          <th>KHÁCH HÀNG</th>
          <th>THỊ TRƯỜNG</th>
          <th>SDT</th>
          <th style="width: 70%;">NỘI DUNG </th>
          <th>NGÀY</th>
          <th>SỐ LẦN GỬI</th>
          <th>TRẠNG THÁI</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td (click)="clearSearchSms()"><span nz-icon nzType="history"></span></td>
          <td>
            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Tìm khách hàng" [(ngModel)]="selectedCustomer"
              style="border: none" (ngModelChange)="searchHistorySMS()" style="width: 100%; border: none">
              <ng-container *ngFor="let data of output.summary">
                <nz-option nzLabel="{{data.customerName}}" nzValue="{{data.col4}}"
                  *ngIf="data.col5 == '0201032'"></nz-option>
              </ng-container>
            </nz-select>
          </td>
          <td>
            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Tìm thị trường" [(ngModel)]="selectedMarket"
              (ngModelChange)="searchHistorySMS()" style="width: 100%; border: none">
              <ng-container *ngFor="let data of input.market">
                <nz-option nzLabel="{{data.name}}" nzValue="{{data.code}}"></nz-option>
              </ng-container>
            </nz-select>
          </td>
          <!-- <td> <input type="text" nz-input [(ngModel)]="inputValue" placeholder="input with clear icon" /></td> -->
          <td colspan="2"><input nz-input [(ngModel)]="inputSearchCustomer" placeholder="NỘI DUNG"
              (ngModelChange)="searchHistorySMS()" type="text" style="border: 1px solid #d9d9d9;" /></td>
          <td class="align-center">-</td>
          <td class="align-center">-</td>
          <td nzAlign="center">
            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Tìm trạng thái" [(ngModel)]="selectedTrangThai"
              style="border: none" (ngModelChange)="searchHistorySMS()" style="width: 100%;">
              <nz-option nzLabel="Chưa gửi" nzValue="C"></nz-option>
              <nz-option nzLabel="Đang gửi" nzValue="N"></nz-option>
              <nz-option nzLabel="Đã gửi" nzValue="Y"></nz-option>
              <nz-option nzLabel="Gửi thất bại" nzValue="TB"></nz-option>
            </nz-select>
          </td>
        </tr>
        @for (data of historyTable.data; track data) {
        <tr>
          <td [nzChecked]="isCheckedSendSms(data.id)" [nzDisabled]="data.isSend == 'N'&& data.numberRetry < 3"
            (nzCheckedChange)="onItemCheckedSendSms(data.id, $event)">
          </td>
          <td title="{{ getCustomerName(data.customerCode) }}"
            [innerText]="_global.removeHtmlTags(getCustomerName(data.customerCode) )">{{data.customerCode}}</td>
          <td title="{{ getMarketName(data.marketCode) }}"
            [innerText]="_global.removeHtmlTags(getMarketName(data.marketCode) )"></td>
          <td>{{data.phoneNumber}}</td>
          <td title="{{data.contents}}" [innerText]="_global.removeHtmlTags(data.contents)"></td>
          <td class="align-center">{{ data.createDate | date: 'hh:mm dd/MM/yyyy' }}</td>
          <td class="align-center">{{ data.numberRetry}}</td>
          <td nzAlign="center">{{ data.isSend == "Y" ? "Đã gửi" : data.isSend == "C" ? "Chưa gửi" : data.isSend == "N"
            && data.numberRetry == 3 ? "Gửi thất bại" : "Đang gửi" }}</td>
        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>

  <ng-template #modalFooter>
    <div style="display: flex; justify-content: flex-end;">
      <button nz-button nzType="default" (click)="handleCancel()">Đóng</button>
      <button nz-button nzType="primary" (click)="onSendSms()" [nzLoading]="isConfirmLoading">Gửi SMS</button>
      <button nz-button (click)="ResendSms()" [nzLoading]="isConfirmLoading">Gửi lại SMS</button>
    </div>
  </ng-template>
</nz-modal>

<!-- MAIL -->
<nz-modal nzWidth="80%" [(nzVisible)]="isVisibleEmail" nzTitle="LỊCH SỬ GỬI MAIL" (nzOnCancel)="handleCancel()"
  [nzFooter]="modalFooterEmail">
  <ng-container *nzModalContent>
    <nz-table #historyTable [nzData]="lstSearchEmail" nzSize="small">
      <thead>
        <tr>
          <th [(nzChecked)]="checkedSms" (nzCheckedChange)="onAllCheckedSendEmail($event)"></th>
          <th>KHÁCH HÀNG</th>
          <th>MAIL</th>
          <th style="width: 70%;">NỘI DUNG </th>
          <!-- <th>NGÀY</th> -->
          <th>File đính kèm</th>
          <th>SỐ LẦN GỬI</th>
          <th>TRẠNG THÁI</th>

        </tr>
      </thead>
      <tbody>
        <tr>
          <td (click)="clearSearchMail()"><span nz-icon nzType="history"></span></td>
          <td>
            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Tìm khách hàng" [(ngModel)]="selectedCustomerMail"
              style="border: none" (ngModelChange)="searchHistoryMail()" style="width: 100%; border: none">
              <ng-container *ngFor="let data of output.bbdo">
                <nz-option nzLabel="{{data.customerName}}" nzValue="{{data.customerCode}}"
                  *ngIf="data.id != null"></nz-option>
              </ng-container>
            </nz-select>
          </td>
          <td colspan="2"><input nz-input [(ngModel)]="inputSearchCustomer" placeholder="NỘI DUNG"
              (ngModelChange)="searchHistoryMail()" type="text" style="border: 1px solid #d9d9d9;" /></td>
          <td class="align-center">-</td>
          <td class="align-center">-</td>
          <td nzAlign="center">
            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Tìm trạng thái" [(ngModel)]="selectedTrangThaiMail"
              style="border: none" (ngModelChange)="searchHistoryMail()" style="width: 100%;">
              <nz-option nzLabel="Chưa gửi" nzValue="C"></nz-option>
              <nz-option nzLabel="Đang gửi" nzValue="N"></nz-option>
              <nz-option nzLabel="Đã gửi" nzValue="Y"></nz-option>
              <nz-option nzLabel="Gửi thất bại" nzValue="TB"></nz-option>
            </nz-select>
          </td>
        </tr>
        @for (data of historyTable.data; track data) {
        <tr>
          <td [nzChecked]="isCheckedSendEmail(data.id)" [nzDisabled]="data.isSend == 'N'&& data.numberRetry < 3"
            (nzCheckedChange)="onItemCheckedSendEmail(data.id, $event)">
          </td>

          <td>{{data.customerName}}</td>
          <td>{{data.email}}</td>
          <td title="{{data.contents}}" [innerText]="_global.removeHtmlTags(data.contents)"></td>
          <td>{{data.checkFile}}</td>
          <td class="align-center">{{ data.numberRetry}}</td>
          <td nzAlign="center">{{ data.numberRetry == 3 && data.isSend == "N" ? "Gửi thất bại" : data.isSend == "Y" ?
            "Đã gửi" : data.isSend
            == "C" ? "Chưa gửi" : "Đang gửi" }}</td>

        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>

  <ng-template #modalFooterEmail>
    <div style="display: flex; justify-content: flex-end;">
      <button nz-button nzType="default" (click)="handleCancel()">Đóng</button>
      <button nz-button nzType="primary" (click)="onSendEmail()" [nzLoading]="isConfirmLoading">Gửi Mail</button>
      <button nz-button (click)="ResendEmail()" [nzLoading]="isConfirmLoading">Gửi lại Email</button>
    </div>
  </ng-template>
</nz-modal>
<!-- History Export File-->
<nz-modal nzWidth="60%" [(nzVisible)]="isVisibleExport" nzTitle="LỊCH SỬ XUẤT FILE" (nzOnCancel)="handleCancel()"
  nzCancelText="Đóng" nzFooter=" ">
  <ng-container *nzModalContent>
    <nz-table #historyTableFile [nzData]="lstHistoryFile" nzSize="small">
      <thead>
        <tr>
          <th></th>
          <th class="align-center">Tên file</th>
          <th class="align-center">Người xuất</th>
          <th class="align-center">Thời gian</th>
          <th class="align-center" colspan="2">Hành động</th>
        </tr>
      </thead>
      <tbody>
        @for (data of historyTableFile.data; track data) {
        <tr>
          <td *ngIf="data.type == 'xlsx'">
            <img src="/assets/img/excel.png" style="width: 24px" />
          </td>
          <td *ngIf="data.type == 'docx'">
            <img src="/assets/img/word.png" style="width: 24px" />
          </td>
          <td *ngIf="data.type == 'pdf'">
            <img src="/assets/img/pdf.png" style="width: 24px" />
          </td>
          <td>{{ data.name }}</td>
          <td class="align-center">{{ data.createBy }}</td>
          <td class="align-center">
            {{ data.createDate | date: 'hh:mm dd/MM/yyyy' }}
          </td>
          <td class="align-center">
            <button nzAlign="center" nz-button nzType="default" (click)="Preview(data)">
              <span nz-icon nzType="eye"></span>Xem trực tiếp
            </button>
          </td>
          <td class="align-center" nzAlign="center">
            <button nzAlign="center" nz-button nzType="default" (click)="openNewTab(data.pathDownload)">
              <span nz-icon nzType="download"></span>Tải xuống
            </button>
          </td>
        </tr>
        }
      </tbody>
    </nz-table>
  </ng-container>
</nz-modal>

<nz-modal nzWidth="90%" [(nzVisible)]="isVisiblePreview" nzTitle="Xem trước" (nzOnCancel)="handleCancel()">
  <ng-container *nzModalContent>
    <ngx-doc-viewer [url]="UrlOffice" viewer="google" style="width:100%;height:93vh;">
    </ngx-doc-viewer>
  </ng-container>

</nz-modal>
<nz-modal nzWidth="90%" nzHeight="90%" [(nzVisible)]="isVisiblePreviewExcel" nzTitle="Xem trước excel"
  (nzOnCancel)="handleCancel()">

  <ng-container *nzModalContent>
    <document-editor (id)="idramdom" documentServerUrl="http://sso.d2s.com.vn:1239" [config]="config"
      [events_onDocumentReady]="onDocumentReady" [height]="'900'">
    </document-editor>
  </ng-container>

</nz-modal>
